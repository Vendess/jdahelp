Rozhodovací strom je metóda strojového učenia používaná na klasifikáciu alebo regresiu. Predstav si ho ako sériu rozhodnutí "áno/nie", ktoré postupne vedú k predikcii cieľovej premennej.

Jednoducho povedané:
Rozhodovací strom vytvára hierarchickú štruktúru, ktorá umožňuje predikovať kategóriu alebo hodnotu pre nové dáta.

Príklad
Predstav si, že pracuješ v banke a chceš predikovať, či nový klient predstavuje vysoké alebo nízke riziko úveru:

Ak má klient vysoký príjem a stabilnú históriu splácania, patrí do kategórie "nízke riziko".
Ak má nízky príjem a nespláca pravidelne, patrí do kategórie "vysoké riziko".
Ak má priemerný príjem, ale vysoký dlh, môže patriť do kategórie "stredné riziko".
Rozhodovací strom analyzuje rôzne atribúty klienta (napr. príjem, aktuálne dlhy, počet omeškaných platieb) a rozhoduje, do ktorej kategórie klient patrí.
Takto môže banka predikovať riziko nového klienta a prijať adekvátne opatrenia pri schvaľovaní úveru.

===========

Čo je to Confusion Matrix?
Confusion Matrix je jednoduchý spôsob, ako zistiť, ako dobre klasifikačný model predpovedá jednotlivé triedy.
Porovnáva skutočné hodnoty (y_test) so skutočne predikovanými hodnotami (y_pred).

Štruktúra confusion matrix:
                  Predikované: 0	Predikované: 1
Skutočné: 0	 True Negative (TN)	 False Positive (FP)
Skutočné: 1	 False Negative (FN) True Positive (TP)

***

from sklearn.metrics import confusion_matrix
import numpy as np

# Skutočné a predikované hodnoty
y_test = np.array([0, 1, 0, 1, 0, 1, 1])
y_pred = np.array([0, 0, 0, 1, 1, 1, 0])

# Výpočet confusion matrix
cm = confusion_matrix(y_test, y_pred)
print(cm)
Výstup:

[[2 1]
 [1 3]]

===========

Classification Report je súhrnná tabuľka metrík, ktorá z Confusion Matrix automaticky vypočíta najdôležitejšie hodnoty pre každú triedu:

Precision (Presnosť) – koľko z predikcií danej triedy bolo správnych → TP / (TP + FP)
Recall (Návratnosť / Sensitivity) – koľko skutočných prípadov model správne identifikoval → TP / (TP + FN)
F1-score – harmonický priemer precision a recall → 2 * (Precision * Recall) / (Precision + Recall)
Support – počet skutočných vzoriek danej triedy v testovacej množine

***

from sklearn.metrics import classification_report
import numpy as np

y_test = np.array([0, 1, 0, 1, 0, 1, 1])
y_pred = np.array([0, 0, 0, 1, 1, 1, 0])

report = classification_report(y_test, y_pred)
print(report)

***

from sklearn.metrics import classification_report
import numpy as np

y_test = np.array([0, 1, 0, 1, 0, 1, 1])
y_pred = np.array([0, 1, 0, 0, 1, 1, 1])

report = classification_report(y_test, y_pred)
print(report)

===========

Úloha RS

1. Načítaj dáta CO2 (alebo údaje klientov banky) do dataframe s názvom CO2.
Dáta sú dostupné v csv súbore: CO2.csv alebo na Moodly.
Odstráň stĺpce Plant a prípadne aj Unnamed: 0, ak sa v datasete nachádzajú.

2. Definuj vstupné a cieľové atribúty:
X = všetky atribúty okrem Treatment
y = atribút Treatment

3. Zakóduj kategorické atribúty v X pomocou one-hot encodingu, aby model vedel pracovať aj s kategorickými premennými.

4. Rozdeľ dáta na trénovaciu a testovaciu množinu v pomere 70:30 pomocou train_test_split.
X_train, X_test, y_train, y_test

5. Vytvor model rozhodovacieho stromu s názvom co2_tree, ktorý bude predikovať hodnotu atribútu Treatment na základe všetkých ostatných atribútov.
Nezabudni model natrénovať pomocou trénovacích dát.

6. Vizualizuj strom:
zobraz slovnú podobu rozhodovacieho stromu,
a následne aj grafickú podobu pomocou vhodnej knižnice.

7. Po natrénovaní modelu vykonaj predikciu na testovacích dátach a ulož výsledky do premennej y_pred_tree.

8. Vyhodnoť výkon modelu:
vytvor confusion matrix (kontingenčnú tabuľku),
vypočítaj precision, recall, f1-score pomocou classification_report.
Tip:
Metriky z confusion matrix ti ukážu, ako dobre model klasifikuje jednotlivé triedy a kde robí chyby.
Na komplexné vyhodnotenie môžeš použiť classification_report z knižnice scikit-learn.

=========================================

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.model_selection import train_test_split
from sklearn.tree import DecisionTreeClassifier, plot_tree, export_text
from sklearn.preprocessing import LabelEncoder
from sklearn.metrics import confusion_matrix, classification_report, accuracy_score

=========================================

CO2 = pd.read_csv('CO2.csv')

if 'Plant' in CO2.columns:
    CO2 = CO2.drop(columns='Plant')
if 'Unnamed: 0' in CO2.columns:
    CO2 = CO2.drop(columns='Unnamed: 0')

=========================================

X = CO2.drop('Treatment', axis=1)
y = CO2['Treatment']

print(f"\nVstupné atribúty (X): {list(X.columns)}")
print(f"\nTriedy v Treatment: {y.unique()}")

=========================================

print(f"\nPôvodný počet stĺpcov v X: {X.shape[1]}")

# Identifikácia kategorických stĺpcov
categorical_cols = X.select_dtypes(include=['object']).columns.tolist()
print(f"Kategorické stĺpce: {categorical_cols}")

# One-hot encoding
X_encoded = pd.get_dummies(X, columns=categorical_cols, drop_first=True)

print(f"Počet stĺpcov po kódovaní: {X_encoded.shape[1]}")
print(f"Nové stĺpce:\n{list(X_encoded.columns)}")

=========================================

# 4. Rozdelenie na trénovaciu a testovaciu množinu
X_train, X_test, y_train, y_test = train_test_split(
    X_encoded, y, test_size=0.3, random_state=42, stratify=y
)

=========================================

# 5. Vytvorenie a trénovanie modelu
co2_tree = DecisionTreeClassifier(max_depth=4, random_state=42, min_samples_split=5)
co2_tree.fit(X_train, y_train)

=========================================

print(f"Hĺbka stromu: {co2_tree.get_depth()}")
print(f"Počet listov: {co2_tree.get_n_leaves()}")
print(f"Počet uzlov: {co2_tree.tree_.node_count}")

=========================================

#slovna
tree_rules = export_text(co2_tree, feature_names=list(X_encoded.columns))
print(tree_rules)

=========================================

#graficka
plt.figure(figsize=(20, 10))
plot_tree(co2_tree, 
          feature_names=list(X_encoded.columns),
          class_names=list(co2_tree.classes_),
          filled=True,
          rounded=True,
          fontsize=10)
plt.title('Rozhodovací strom - CO2 Dataset', fontsize=16, fontweight='bold')
plt.tight_layout()
plt.show()

=========================================

# predikcia
y_pred_tree = co2_tree.predict(X_test)

print(f"\nPočet predikcií: {len(y_pred_tree)}")
print(f"\nPrvých 10 porovnaní:")
comparison = pd.DataFrame({
    'Skutočné': y_test.values[:10],
    'Predikované': y_pred_tree[:10]
})
print(comparison)

=========================================

# Presnosť modelu
accuracy = accuracy_score(y_test, y_pred_tree)
print(f"\nCelková presnosť (Accuracy): {accuracy:.4f} ({accuracy*100:.2f}%)")

=========================================

# a) Confusion Matrix
print("\n--- CONFUSION MATRIX ---")
cm = confusion_matrix(y_test, y_pred_tree)
print(cm)

plt.figure(figsize=(8, 6))
sns.heatmap(cm, annot=True, fmt='d', cmap='Blues', 
            xticklabels=co2_tree.classes_,
            yticklabels=co2_tree.classes_)
plt.xlabel('Predikované')
plt.ylabel('Skutočné')
plt.title('Confusion Matrix - Rozhodovací strom')
plt.tight_layout()
plt.show()

=========================================

print("\n--- CLASSIFICATION REPORT ---")
print("\nDetailné metriky pre každú triedu:")
report = classification_report(y_test, y_pred_tree)
print(report)

=========================================
