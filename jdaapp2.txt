'''
pip install streamlit pandas matplotlib seaborn
5. Spustanie v datalabe
streamlit run app.py --browser.serverAddress 0.0.0.0 --server.enableCORS False
ZmeÅˆ pathku v prehliadaÄi: vÅ¡etko od /lab nahraÄ /proxy/8501/app kde app je nÃ¡zov app.py
#https://datalab.kkui.fei.tuke.sk/jupyter/user/sk549ac/proxy/8501/app
'''

import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# 1. KonfigurÃ¡cia strÃ¡nky
st.set_page_config(
    page_title='Tips Dashboard', layout='wide',
    initial_sidebar_state='expanded'
)

st.title("Tips Dashboard ğŸ½ï¸")
st.markdown("InteraktÃ­vna analÃ½za ÃºÄtov a tipov z datasetu `tips` (seaborn).")

# 2. NaÄÃ­tanie dÃ¡t s cachovanÃ­m
@st.cache_data
def load_data():
    return sns.load_dataset('tips')
df = load_data()

# 3. UkÃ¡Å¾ka dÃ¡t v expanderi
with st.expander("UkÃ¡Å¾ka datasetu"):
    st.dataframe(df.head())

# 4. Sidebar â€“ vstupy
st.sidebar.header("Filter")

# VÃ½ber dÅˆa
days = df['day'].unique().tolist()
selected_days = st.sidebar.multiselect(
    "Vyber deÅˆ:", options=days, default=days, key='day_select'
)

# VÃ½ber Äasu (Lunch/Dinner)
times = df['time'].unique().tolist()
selected_time = st.sidebar.selectbox(
    "Vyber Äas:", options=times, index=0, key='time_select'
)

# Slider pre veÄ¾kosÅ¥ skupiny
group_size = st.sidebar.slider(
    "VeÄ¾kosÅ¥ skupiny (poÄet osÃ´b):", min(df['size']), max(df['size']), (1, max(df['size'])), key='size_range'
)

# 5. FiltrÃ¡cia dÃ¡t
df_filtered = df[
    (df.day.isin(selected_days)) &
    (df.time == selected_time) &
    (df["size"].between(group_size[0], group_size[1]))
]
st.write(f"**Filter count:** {df_filtered.shape[0]} riadkov")

# 6. VizualizÃ¡cia scatter plot
fig, ax = plt.subplots(figsize=(8, 5))
ax.scatter(df_filtered.total_bill, df_filtered.tip)
ax.set_xlabel("Total Bill")
ax.set_ylabel("Tip")
ax.set_title("Tip vs. Total Bill")
st.pyplot(fig)

# 7. Bar chart priemernej vÃ½Å¡ky tipu podÄ¾a dÅˆa
df_bar = (
    df_filtered.groupby('day')['tip']
    .mean()
    .reset_index()
)
fig2, ax2 = plt.subplots(figsize=(6, 4))
ax2.bar(df_bar['day'], df_bar['tip'])
ax2.set_xlabel("Day")
ax2.set_ylabel("Average Tip")
ax2.set_title("PriemernÃ½ tip podÄ¾a dÅˆa")
st.pyplot(fig2)

# 8. Stiahnutie dÃ¡t
to_download = df_filtered.to_csv(index=False).encode('utf-8')
st.download_button(
    "StiahnuÅ¥ filtrovanÃ© dÃ¡ta CSV",
    data=to_download,
    file_name='tips_filtered.csv',
    mime='text/csv'
)
